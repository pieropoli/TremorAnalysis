clear
clc
close


addpath /Users/pieropoli/GISMO_r362/GISMO
startup_GISMO
%addpath /Users/pieropoli/Autmoatic_Parsing_Downloading_Events/ContinuosDataScanning/mat


load('/Users/pieropoli/Autmoatic_Parsing_Downloading_Events/TremorAnalysis/CorrelationsCodes/DataProcessed/julDay_5.mat')
win = 300; %sec

btord=3;


FB = [0.02 0.05];
% filter
Filt   = filterobject('B',FB,btord); % create a frequency filter for waveform
W1 = double(filtfilt(Filt,W)); % apply the filter to the data

FB1 = [2 8];
Filt   = filterobject('B',FB1,btord); % create a frequency filter for waveform
W2 = double(filtfilt(Filt,W)); % apply the filter to the data

la = get(W,'stla');
lo = get(W,'stlo');

d = distance(mean(la),mean(lo),la,lo);
d = deg2km(d);
c=1;
for t1 = 1 : win*25 : length(W2)
    
    wb = W1(t1:t1+win*25,:);
    wb2=W2(t1:t1+win*25,:);
    
    p = -1:0.05:1;
    
    [m] = inverse_radon_freq((wb')',1/25,d,p,1,min(FB),max(FB),.1,'adj');
    m = m.^2;
    
    [minM,idx] = max(m(:));
    [ix,iy] = ind2sub(size(m),idx);
    
    pout(c) = p(iy);
    maxi(c) = minM;
    c=c+1;
 
    close
end